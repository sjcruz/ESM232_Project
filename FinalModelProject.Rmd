---
title: "Final Model Project"
author: "Juliette Verstaen and Seleni Cruz"
date: "5/12/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(magrittr)
library(tidyverse)
library(deSolve)
library(dplyr)
library(zeallot)

```



Run Model to Equilibrium
```{r}

source("R/wrapper.R")
source("R/predprey.R")
source("R/extract.R")

# First call of the model to reach equilibrium
start <- wrapper_model(hx = 0, hp = 0, t0=0, t1 = 30, X0 = 25, P0 = 25)

# Extract final conditions and start trophic downgrading
c(X1, P1) %<-%  extract_state_vars(start)
harvest_P <- wrapper_model(hx = 0, t0 = 30, t1 = 70, X0 = X1, P0 = P1)

# Extract final conditions and start fishing for prey too
c(X2, P2) %<-% extract_state_vars(harvest_P)
harvest_X <- wrapper_model(t0 = 70, t1 = 120, X0 = X2, P0 = P2)

```

Syncronous Recovery
What about happen if fishing was completly halted
```{r}

# Stop fishing and let both species recover
c(X3, P3) %<-% extract_state_vars(harvest_X)

stop_harvest <- wrapper_model(hx = 0, hp = 0, t0 = 120, t1 = 200, X0 = X3, P0 = P3)
# create ggplot object
both <- rbind(start, harvest_P, harvest_X, stop_harvest) %>% ggplot(aes(x = Time, y = Abundance)) +
geom_line(aes(color = Organism), size = 1) + scale_color_brewer(palette = "Set1") + theme(legend.position = "none")

both

```


```{r}

source("R/wrapperTEST.R")
source("R/mpa_var_setup.R")
source("R/run_mpa.R")
source("R/predprey.R")
source("R/extract.R")




# First call of the model to reach equilibrium
start_test <- wrapper_modelTEST(hx = 0, hp = 0, t0=0, t1 = 30, X0 = 25, P0 = 25, MPA_width=0)

# Extract final conditions 
c(X1, P1) %<-%  extract_state_vars(start)


testmpa <- wrapper_modelTEST(t0=0, t1 = 30, X0=X1, P0=P1, MPA_width=4)







rx = 1
Kx = 100
ax = 0.03
hx = 0.65
c = 0.05
ay = 0.03
dp = 0.25
Kp = 25
hp = 0.32
t0 = 0
t1 = 40

pars <- c(rx, Kx, ax, hx, c, ay, dp, Kp, hp)
values <- c(X1, P1) 
time <- seq(t0, t1, by = 0.1)

surplus <- pred_prey(pars = pars, values= values, t=time) %>%
  extract2(1)

surplusX <- surplus[1]
surplusP <- surplus[2]
  
  
  catchesX<- harvest_mpa_hx*popX
  catchesP<- harvest_mpa_hp*popP




```

goliath grouper, yellow snapper (main prey), parrotfish (subprey) 

Issues:
1. when to loop for the Mpa movement (in the mpa function one or the wrapper)
2. have two mrates for the prey and predator, need to figure out what to do with that

Things to rememeber/clean up:

1. some things named as vectors when lists, make sure to go through and clean it all up to make it understandable
2. goliah grouper growth rate (c) = 0.2 +- 0.03
3. sensitiy analysis on: c, r, and hx, hp
4. movement = 0.5 for both

Sensitivity Analysis:



